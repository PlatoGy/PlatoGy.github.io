---
layout: post
title: GPUç¼–ç¨‹PPT4
author: Patrick Gao
date: 2025-04-08 14:10
categories:
  - MISCADA
  - GPU Course
tags:
  - GPU Programming
mermaid: true
math: true
pin: false
---

# SYCL ç¼–ç¨‹æ¨¡å‹ç¬”è®°ï¼ˆCOMP52315 GPU Programmingï¼‰

## ğŸ“Œ è¯¾ç¨‹ä¿¡æ¯
- **è¯¾ç¨‹åç§°**ï¼šGPU Programming
- **è®²å¸ˆ**ï¼šChristopher Marcotte  
- **é‚®ç®±**ï¼šchristopher.marcotte@durham.ac.uk  

---

## ğŸ¯ SYCL ç›®æ ‡
- ç”¨äºå¼‚æ„ç³»ç»Ÿï¼ˆCPU/GPU/FPGAï¼‰çš„ **é«˜å±‚æ¬¡å•æºç¼–ç¨‹æ¨¡å‹**
- ä½¿ç”¨ç°ä»£ ISO C++ ç¼–å†™
- ä¸‰å¤§æ‰©å±•ï¼š
  1. **è®¾å¤‡å‘ç°**ä¸ä¿¡æ¯è·å–
  2. **è®¾å¤‡æ§åˆ¶**ï¼ˆè®¡ç®—å†…æ ¸ + å†…å­˜ç®¡ç†ï¼‰
  3. **ä¾èµ–ç®¡ç†**ä¸è°ƒåº¦

---

## ğŸ“– SYCL è§„èŒƒ
- ç”± **Khronos Group** ç»´æŠ¤
- å½“å‰ç‰ˆæœ¬ï¼š**SYCL 2020**
- [SYCL è§„èŒƒ PDF](https://registry.khronos.org/SYCL/specs/sycl-2020/pdf/sycl-2020.pdf)  
- [SYCL è¯­æ³•é€ŸæŸ¥è¡¨](https://www.khronos.org/files/sycl/sycl-2020-reference-guide.pdf)  
- [C++ Execution Library (C++26)](https://en.cppreference.com/w/cpp/execution)

---

## ğŸ§© SYCL å®ç°
å¸¸ç”¨ç¼–è¯‘å™¨ï¼š
- `clang++`ï¼ˆLLVMï¼‰
- `dpcpp` / `icpx`ï¼ˆIntelï¼‰

åœ¨ NCC ä¸Šä½¿ç”¨æ–¹æ³•ï¼š
```bash
module load llvm-clang
module load cuda/11.5

clang++ -fsycl -fsycl-targets=nvptx64-nvidia-cuda my_code.cpp -o my_executable
```
> CUDAç‰ˆæœ¬è¦æ±‚ â‰¤ 11.5

---

## ğŸ” è®¾å¤‡å‘ç° & ä¿¡æ¯æŸ¥è¯¢

```cpp
auto devices = sycl::device::get_devices();
for (auto d : devices)
    std::cout << d.get_info<sycl::info::device::name>() << "
";
```

å¿«é€ŸæŸ¥çœ‹å½“å‰è®¾å¤‡ï¼š
```cpp
sycl::queue q;
std::cout << "Device: " 
          << q.get_device().get_info<sycl::info::device::name>() << "
";
```

æŒ‡å®šè®¾å¤‡ï¼ˆå¦‚ `cpu`, `gpu`ï¼‰ï¼š
```cpp
sycl::gpu_selector gpu;
sycl::queue q(gpu);
```

---

## ğŸ§  SYCL ç¨‹åºç»“æ„

### Lambda è¡¨è¾¾å¼
```cpp
[capture](params) { body }
```
- `[=]`ï¼šé»˜è®¤å€¼æ•è·ï¼ˆby copyï¼‰
- `[&]`ï¼šå¼•ç”¨æ•è·ï¼ˆby referenceï¼‰

---

### SYCL ç¤ºä¾‹ç¨‹åº

```cpp
#include <sycl/sycl.hpp>
sycl::queue q;
std::vector<double> x(N, 1.0);

{
    sycl::buffer<double, 1> x_buf(x.data(), x.size());
    q.submit([&](sycl::handler& cgh) {
        auto x_d = x_buf.get_access<sycl::access::mode::read_write>(cgh);
        cgh.single_task([=]() {
            for (int i = 0; i < N; i++)
                x_d[i] = 2.0;
        });
    });
}
for (auto val : x) std::cout << val << " ";
```

---

## ğŸš€ SYCL æ‰§è¡Œæ¨¡å‹
- æºäº OpenCL
- **ND-range**ï¼šç”± work-group ç»„æˆï¼Œwork-group åŒ…å«å¤šä¸ª work-item
- å¯ä¸º 1Dã€2Dã€3D ç©ºé—´å®šä¹‰ï¼š
  - Global range: æ€» work-items æ•°é‡
  - Local range: æ¯ç»„ work-items çš„æ•°é‡

---

## ğŸ§µ å†…æ ¸å‡½æ•°ï¼ˆKernelï¼‰API

### Single Task
```cpp
q.submit([&](handler& cgh){
    cgh.single_task([=]() {
        /* device code */
    });
}).wait();
```

### Parallel Forï¼ˆé«˜å±‚ç‰ˆæœ¬ï¼‰

```cpp
cgh.parallel_for(sycl::range<1>(N), [=](sycl::id<1> i) {
    x_d[i] += 1;
});
```

### ND-Range ç‰ˆæœ¬

```cpp
sycl::range global{2, 2, 2};
sycl::range local{2, 2, 2};

q.submit([&](sycl::handler& cgh) {
    cgh.parallel_for(sycl::nd_range{global, local},
        [=](sycl::nd_item<3> i) {
            printf("My global id in z is %lu\n", i.get_global_id(2));
        });
}).wait();
```

---

## âš ï¸ SYCL å†…æ ¸é™åˆ¶
åœ¨å†…æ ¸ä¸­ **ä¸å…è®¸**ï¼š
- åŠ¨æ€å†…å­˜åˆ†é…
- é€’å½’
- å¤šæ€/è™šå‡½æ•°
- å‡½æ•°æŒ‡é’ˆ
- `std::` æ ‡å‡†åº“ï¼ˆå¦‚ `std::vector`, `std::string` ç­‰ï¼‰

---

## ğŸ§  å†…å­˜ç®¡ç†æ–¹å¼

### Buffer-Accessor æ¨¡å‹
- ä½¿ç”¨ `sycl::buffer` å°è£…æ•°æ®
- åœ¨ `queue.submit()` å†…ç”¨ `accessor` è®¿é—®
- **buffer ç”Ÿå‘½å‘¨æœŸç»“æŸ**æ—¶ä¼šè‡ªåŠ¨åŒæ­¥æ•°æ®

### Unified Shared Memory (USM)

```cpp
int* data = malloc_shared<int>(N, q);
q.parallel_for(sycl::range<1>(N), [=](sycl::id<1> i) {
    data[i] *= 2;
}).wait();
```

---

## ğŸ“š æ›´å¤šå­¦ä¹ èµ„æº

- SYCL API æ–‡æ¡£: [SYCL Doxygen](https://intel.github.io/llvm-docs/doxygen/group__sycl__api.html)
- CUDA åˆ° SYCL è¿ç§»æŒ‡å—:  
  [Codeplay Guide](https://developer.codeplay.com/products/computecpp/ce/1.1.4/guides/sycl-for-cuda-developers/migration)
- SYCL Academy æ•™ç¨‹:  
  [GitHub](https://github.com/codeplaysoftware/syclacademy)
- DPC++ äº’åŠ¨æ•™å­¦å¹³å°ï¼š  
  [CodinGame Playground](https://www.codingame.com/playgrounds/53666/dpc/hello-dpc)
- å…è´¹ä¹¦ç±ï¼š  
  [Mastering DPC++ (Springer)](https://link.springer.com/book/10.1007/978-1-4842-5574-2)
