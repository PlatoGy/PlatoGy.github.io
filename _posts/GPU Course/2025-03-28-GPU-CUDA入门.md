---
layout: post
title: CUDA å…¥é—¨
author: Patrick Gao
date: 2025-03-28 02:47
categories:
  - MISCADA
  - GPU Course
tags:
  - GPU Programming
mermaid: true
math: true
pin: false
---
# ğŸš€ CUDA C++ å…¥é—¨æ•™ç¨‹ï¼šå‘é‡åŠ æ³•ç¤ºä¾‹

æœ¬æ•™ç¨‹å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ CUDA C++ åœ¨ GPU ä¸Šå®ç°ä¸¤ä¸ªå‘é‡çš„åŠ æ³•æ“ä½œã€‚

---

## âœ… æ•™ç¨‹æµç¨‹

1. åœ¨ä¸»æœºï¼ˆHostï¼‰ä¸Šåˆ†é…å†…å­˜å¹¶åˆå§‹åŒ–æ•°æ®
2. åˆ†é…è®¾å¤‡ï¼ˆDeviceï¼‰å†…å­˜
3. å°†æ•°æ®ä»ä¸»æœºå¤åˆ¶åˆ°è®¾å¤‡
4. å¯åŠ¨ CUDA æ ¸å‡½æ•°ï¼ˆKernelï¼‰å¹¶è¡Œæ‰§è¡Œ
5. å°†ç»“æœå¤åˆ¶å›ä¸»æœº
6. éªŒè¯è®¡ç®—ç»“æœ
7. é‡Šæ”¾å†…å­˜èµ„æº

---

## ğŸ“¦ ç¤ºä¾‹ä»£ç ï¼ˆvector_add.cuï¼‰

```cpp
#include <iostream>
#include <cuda_runtime.h>

// CUDA æ ¸å‡½æ•°ï¼šæ¯ä¸ªçº¿ç¨‹è´Ÿè´£åŠ ä¸€ä¸ªå…ƒç´ 
__global__ void vectorAdd(const float* A, const float* B, float* C, int N) {
    int i = blockIdx.x * blockDim.x + threadIdx.x;
    if (i < N) {
        C[i] = A[i] + B[i];
    }
}

int main() {
    int N = 1 << 20; // 1M å…ƒç´ 
    size_t size = N * sizeof(float);

    // 1. ä¸»æœºå†…å­˜åˆ†é…
    float *h_A = (float*)malloc(size);
    float *h_B = (float*)malloc(size);
    float *h_C = (float*)malloc(size);

    // 2. åˆå§‹åŒ–æ•°æ®
    for (int i = 0; i < N; ++i) {
        h_A[i] = static_cast<float>(i);
        h_B[i] = static_cast<float>(2 * i);
    }

    // 3. è®¾å¤‡å†…å­˜åˆ†é…
    float *d_A, *d_B, *d_C;
    cudaMalloc((void**)&d_A, size);
    cudaMalloc((void**)&d_B, size);
    cudaMalloc((void**)&d_C, size);

    // 4. å¤åˆ¶æ•°æ®åˆ°è®¾å¤‡
    cudaMemcpy(d_A, h_A, size, cudaMemcpyHostToDevice);
    cudaMemcpy(d_B, h_B, size, cudaMemcpyHostToDevice);

    // 5. å¯åŠ¨æ ¸å‡½æ•°
    int threadsPerBlock = 256;
    int blocksPerGrid = (N + threadsPerBlock - 1) / threadsPerBlock;
    vectorAdd<<<blocksPerGrid, threadsPerBlock>>>(d_A, d_B, d_C, N);

    // 6. å¤åˆ¶ç»“æœå›ä¸»æœº
    cudaMemcpy(h_C, d_C, size, cudaMemcpyDeviceToHost);

    // 7. éªŒè¯ç»“æœ
    bool success = true;
    for (int i = 0; i < N; ++i) {
        if (fabs(h_C[i] - (h_A[i] + h_B[i])) > 1e-5) {
            success = false;
            break;
        }
    }
    std::cout << (success ? "Result verified!\n" : "Result incorrect!\n");

    // 8. é‡Šæ”¾å†…å­˜
    free(h_A); free(h_B); free(h_C);
    cudaFree(d_A); cudaFree(d_B); cudaFree(d_C);

    return 0;
}
```